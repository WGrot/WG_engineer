@page "/manage-reservations"
@using RestaurantApp.Shared.Models
@using System.Net.Http.Json
@using Microsoft.AspNetCore.Authorization
@using RestaurantApp.Blazor.Extensions
@using RestaurantApp.Blazor.Models.DTO
@using RestaurantApp.Blazor.Components
@attribute [Authorize]

<div class="container-fluid px-4">
    <div class="row mb-2">
        <div class="col-12 my-3 card">
            <div class="card-body">
                <h2 class="text-center mb-0">
                    <i class="bi bi-calendar-check me-2"></i>Manage Reservations
                </h2>
                <p class="text-muted text-center">View and manage all restaurant reservations</p>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-3 col-md-3 mb-4">
            <ReservationFilters
                SearchParameters="@searchParameters"
                OnApplyFilters="@LoadInitialReservations"
                OnClearFilters="@ClearParams"/>
        </div>

        <!-- Right Content Area with Reservations -->
        <div class="col-lg-9 col-md-9">
            <div class="d-flex flex-row justify-content-end mb-2">
                <SetPageSizeComponent
                    OnPageSizeChanged="@SetPageSize"
                    Title="Reservations per page: "/>
                <SortDropdown
                    Options="SortOptions"
                    SelectedValue="@searchParameters.SortBy"
                    OnSortChanged="@SortReservations"/>
            </div>
            @if (isInitialLoading)
            {
                <div class="d-flex justify-content-center align-items-center" style="min-height: 400px;">
                    <div class="text-center">
                        <div class="spinner-border text-primary mb-3" role="status"
                             style="width: 3rem; height: 3rem;">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="text-muted">Loading reservations...</p>
                    </div>
                </div>
            }
            else
            {
                foreach (var reservation in reservations)
                {
                    <ReservationCard
                        Reservation="reservation"
                        OnClick="OpenReservationModal"
                        OnApprove="HandleApproveReservation"/>
                }

                @if (hasMoreReservations && reservations.Any())
                {
                    <div class="text-center mt-3">
                        <button class="btn-outline-primary"
                                @onclick="LoadMoreReservations"
                                disabled="@isLoadingMore">
                            @if (isLoadingMore)
                            {
                                <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                                <span>Loading...</span>
                            }
                            else
                            {
                                <i class="bi bi-arrow-down-circle me-2"></i>
                                <span>Load more reservations</span>
                            }
                        </button>
                    </div>
                }
                else
                {
                    <div class="text-center mt-3 text-muted">
                        <i class="bi bi-check-circle me-2"></i>
                        All reservations loaded
                    </div>
                }

                @if (!reservations.Any())
                {
                    <div class="text-center py-5">
                        <i class="bi bi-search text-muted" style="font-size: 4rem;"></i>
                        <p class="text-muted mt-3">No reservations found matching your filters.</p>
                        <button class="btn btn-outline-primary btn-sm" @onclick="() => ClearParams()">
                            Clear Filters
                        </button>
                    </div>
                }
            }

        </div>

    </div>


    <ReservationDetailsModal @bind-IsVisible="showReservationModal"
                             Reservation="selectedReservation"/>

    
</div>



