@inherits ComponentBase
@using RestaurantApp.Shared.Models
@using RestaurantApp.Blazor.Components
@using RestaurantApp.Blazor.Helpers
@using RestaurantApp.Shared.DTOs.Reservation

<GenericModal @bind-IsVisible="IsVisible"
              Title="Manage Reservation"
              Size="GenericModal.ModalSize.Default">
    <ChildContent>
        @if (Reservation is not null)
        {
            <div class="reservation-details mb-4">
                <h6 class="text-primary mb-3">
                    <i class="bi bi-info-circle me-2"></i>Reservation Details
                </h6>
                <div class="bg-light rounded p-3">
                    <div class="row g-2">
                        <div class="col-md-6">
                            <p><strong>Customer:</strong> @Reservation.CustomerName</p>
                            <p><strong>Email:</strong> @Reservation.CustomerEmail</p>
                            <p><strong>Phone:</strong> @Reservation.CustomerPhone</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Date:</strong> @Reservation.ReservationDate.ToLocalTime().ToString("yyyy-MM-dd")
                            </p>
                            <p>
                                <strong>Time:</strong> @Reservation.StartTime.ToString("HH:mm") - @Reservation.EndTime.ToString("HH:mm")
                            </p>
                            @if (Reservation is TableReservationDto)
                            {
                                <p><strong>Table number:</strong> @Reservation.Table.TableNumber</p>
                            }
                            
                            <p><strong>Guests:</strong> @Reservation.NumberOfGuests</p>
                        </div>
                    </div>
                    <div class="mt-3">
                        <p class="mb-0">
                            <strong>Current Status:</strong>
                            <span class="badge @Reservation.Status.GetStatusBadgeClass() ms-2">
                                @Reservation.Status
                            </span>
                        </p>
                    </div>
                </div>
            </div>
            <div class="form-group mb-3">
                <label for="statusSelect" class="form-label">
                    <i class="bi bi-arrow-repeat me-2"></i>Change StatusEnumDto:
                </label>
                <select id="statusSelect" class="form-select" @bind="SelectedStatus">
                    <option value="">-- Select Status --</option>
                    @foreach (var status in Enum.GetValues<ReservationStatusEnumDto>())
                    {
                        <option value="@status">@status</option>
                    }
                </select>
            </div>
        }
    </ChildContent>

    <FooterContent>
        <button class="button button--primary me-2"
                @onclick="OnUpdateClicked"
                disabled="@IsProcessing">
            @if (IsProcessing)
            {
                <span class="spinner-border spinner-border-sm me-2"></span>
            }
            Update Status
        </button>

        <button class="button button--red me-2"
                @onclick="ShowDeleteConfirmation"
                disabled="@IsProcessing">
            <i class="bi bi-trash"></i> Delete
        </button>

        <button class="btn btn-secondary" @onclick="Close">Close</button>
    </FooterContent>
</GenericModal>

<ConfirmationModal @bind-IsVisible="ShowConfirmDelete"
                   Title="Confirm Deletion"
                   Message="Are you sure you want to delete this reservation?"
                   IsProcessing="IsProcessing"
                   OnConfirm="DeleteReservation"/>
