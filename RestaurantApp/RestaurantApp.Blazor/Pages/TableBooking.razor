@page "/booking/table/{restaurantId:int}"
@using RestaurantApp.Blazor.Components
@using RestaurantApp.Blazor.Services
@using RestaurantApp.Shared.DTOs.Restaurant
@inject HttpClient Http
@inject NavigationManager Navigation

<div class="booking-container">
    @if (_isLoadingRestaurant)
    {
        <div class="loading-container">
            <div class="spinner"></div>
            <p>Loading...</p>
        </div>
    }
    else if (_restaurant == null)
    {
        <div class="error">
            <h2>Restaurant not found</h2>
            <button @onclick="GoBack">Go Back</button>
        </div>
    }
    else
    {
        <div class="restaurant-header bg-primary text-white">
            <div class="container py-4">
                <div class="row align-items-center">
                    <div class="col-auto">
                        @if (!string.IsNullOrEmpty(_restaurant.ProfileThumbnailUrl))
                        {
                            <img src="@_restaurant.ProfileThumbnailUrl"
                                 alt="@_restaurant.Name"
                                 class="restaurant-logo rounded shadow-sm"
                                 @onclick="GoBack">
                        }
                        else
                        {
                            <div
                                class="restaurant-logo-placeholder rounded shadow-sm d-flex align-items-center justify-content-center bg-white text-primary">
                                <i class="bi bi-shop fs-1"></i>
                            </div>
                        }
                    </div>
                    <div class="col-auto">
                        <StarRating
                            Restaurant="_restaurant"/>
                        <h1 class="h2 mb-1">@_restaurant.Name</h1>
                        <p class="mb-0 opacity-75">
                            <i class="bi bi-geo-alt-fill me-1"></i>
                            @_restaurant.Address
                        </p>
                    </div>
                    <div class="col-auto ms-1">
                        <button class="base-button lg" @onclick="GoBack">
                            Back to restaurant
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <TableBookingForm
            Id = "@RestaurantId"
            Restaurant="@_restaurant"/>
    }
</div>



@code {
    [Parameter] public int RestaurantId { get; set; }
    [Inject] public required JwtAuthenticationStateProvider AuthStateProvider { get; set; }
    private RestaurantDto? _restaurant;
    private bool _isLoadingRestaurant;

    
    protected override async Task OnInitializedAsync()
    {
        await LoadRestaurantData();
    }

    private async Task LoadRestaurantData()
    {
        try
        {
            _isLoadingRestaurant = true;
            _restaurant = await Http.GetFromJsonAsync<RestaurantDto>($"api/Restaurant/{RestaurantId}");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading restaurant data: {ex.Message}");
            _restaurant = null;
        }
        finally
        {
            _isLoadingRestaurant = false;
        }
    }
    

    private void GoBack()
    {
        Navigation.NavigateTo($"/restaurant/{RestaurantId}");
    }

}

