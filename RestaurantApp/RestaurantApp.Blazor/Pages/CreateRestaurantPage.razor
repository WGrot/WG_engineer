@page "/CreateRestaurant"
@using Microsoft.AspNetCore.Components.Authorization
@using RestaurantApp.Blazor.Services
@using RestaurantApp.Shared.DTOs.Restaurant
@inject NavigationManager Navigation
@inject AuthService AuthService
@inject HttpClient Http

<AuthorizeView>
    <Authorized>
        <div class="container-fluid d-flex flex-column justify-content-center align-items-center vh-100 text-center text-white bg-primary p-4 shadow-lg">
            <h1 class="mb-3">Create Your Restaurant Profile</h1>
            <h5 class="mb-4">
                Fill out the form below to register your restaurant. After that proceed to restaurant edit page to add more details.
            </h5>

            <form class="w-100" style="max-width: 400px;">
                <div class="mb-3 text-start">
                    <label for="restaurantName" class="form-label">Restaurant Name</label>
                    <input type="text" class="form-control" id="restaurantName" @bind="restaurantName" placeholder="Enter restaurant name">
                </div>

                <div class="mb-3 text-start">
                    <label for="restaurantAddress" class="form-label">Restaurant Address</label>
                    <input type="text" class="form-control" id="restaurantAddress" @bind="restaurantAddress" placeholder="Enter restaurant address">
                </div>

                <button type="submit" class="button button--lg button--primary px-5 w-100" @onclick="CreateRestaurant">
                    Create Restaurant Profile
                </button>
            </form>
        </div>
    </Authorized>
    <NotAuthorized>
        <div class="container-fluid d-flex flex-column justify-content-center align-items-center vh-100 text-center text-white bg-primary p-4 shadow-lg">
            <h1 class="mb-3">You need to be logged in and have a verified account to create a restaurant profile</h1>
            <h5 class="mb-4">
                To learn more about restaurant accounts, see
                <a href="/" class="text-warning text-decoration-underline">FAQ</a>
            </h5>
            <button class="button button--lg button--primary px-5" @onclick="GoToLogin">
                Log in
            </button>
        </div>
    </NotAuthorized>
</AuthorizeView>

@code {
    
    private string restaurantName = "";
    private string restaurantAddress = "";
    
    void GoToLogin()
    {
        var returnUrl = Uri.EscapeDataString(new Uri(Navigation.Uri).PathAndQuery);
        Navigation.NavigateTo($"/login?returnUrl={returnUrl}");
    }
    
    private async Task CreateRestaurant()
    {
        var currentUser = AuthService.GetCurrentUserAsync();
        var restaurantDto = new CreateRestaurantDto
        {
            Name = restaurantName,
            Address = restaurantAddress,
            OwnerId = currentUser.Id

        };

        var response = await Http.PostAsJsonAsync("api/Restaurant/create-as-user", restaurantDto);
        if (response.IsSuccessStatusCode)
        {
            Navigation.NavigateTo($"/homepage");
        }

    }
}