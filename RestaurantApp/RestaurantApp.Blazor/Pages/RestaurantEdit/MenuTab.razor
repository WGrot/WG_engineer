@using RestaurantApp.Blazor.Models.DTO
@using RestaurantApp.Shared.Models

<h3>Menu Management</h3>

@if (menu != null)
{
    <div>
        <button @onclick="ShowAddCategoryForm">Add New Category</button>

        @if (showAddCategory)
        {
            <div>
                <h4>New Category</h4>
                <input type="text" @bind="newCategory.Name" placeholder="Category Name" />
                <input type="text" @bind="newCategory.Description" placeholder="Description" />
                <input type="number" @bind="newCategory.DisplayOrder" placeholder="Display Order" />
                <button @onclick="AddCategory">Add</button>
                <button @onclick="() => showAddCategory = false">Cancel</button>
            </div>
        }

        <!-- Lista kategorii -->
        @foreach (var category in categories.OrderBy(c => c.DisplayOrder))
        {
            <div style="border: 1px solid #ccc; margin: 10px; padding: 10px;">
                @if (editingCategoryId == category.Id)
                {
                    <input type="text" @bind="category.Name" />
                    <input type="text" @bind="category.Description" />
                    <input type="number" @bind="category.DisplayOrder" />
                    <button @onclick="() => SaveCategory(category)">Save</button>
                    <button @onclick="() => editingCategoryId = null">Cancel</button>
                }
                else
                {
                    <h4>
                        @category.Name
                        <button @onclick="() => ToggleCategory(category.Id)">
                            @(expandedCategories.Contains(category.Id) ? "Collapse" : "Expand")
                        </button>
                        <button @onclick="() => editingCategoryId = category.Id">Edit</button>
                        <button @onclick="() => DeleteCategory(category.Id)">Delete</button>
                    </h4>
                    @if (!string.IsNullOrEmpty(category.Description))
                    {
                        <p>@category.Description</p>
                    }
                }

                @if (expandedCategories.Contains(category.Id))
                {
                    <div style="margin-left: 20px;">
                        <button @onclick="() => ShowAddItemForm(category.Id)">Add Item</button>

                        @if (showAddItem && addItemToCategoryId == category.Id)
                        {
                            <div>
                                <input type="text" @bind="newItem.Name" placeholder="Item Name" />
                                <input type="text" @bind="newItem.Description" placeholder="Description" />
                                <input type="number" @bind="newItem.Price" placeholder="Price" />
                                <input type="text" @bind="newItem.CurrencyCode" placeholder="Currency (PLN)" />
                                <input type="text" @bind="newItem.ImagePath" placeholder="Image Path" />
                                <button @onclick="() => AddItem(category.Id)">Add</button>
                                <button @onclick="() => showAddItem = false">Cancel</button>
                            </div>
                        }

                        @foreach (var item in categoryItems.GetValueOrDefault(category.Id, new List<MenuItem>()))
                        {
                            <div style="border: 1px solid #ddd; margin: 5px; padding: 5px;">
                                <MenuItemEditComponent
                                    Item="item"
                                    Categories="categories"
                                    OnSave="SaveItem"
                                    OnDelete="DeleteItem"
                                    OnMove="HandleMoveItem" />
                            </div>
                        }
                    </div>
                }
            </div>
        }

        <!-- Pozycje bez kategorii -->
        <div style="border: 1px solid #ccc; margin: 10px; padding: 10px;">
            <h4>
                Uncategorized Items
                <button @onclick="ToggleUncategorized">
                    @(showUncategorized ? "Collapse" : "Expand")
                </button>
            </h4>

            @if (showUncategorized)
            {
                <div style="margin-left: 20px;">
                    <button @onclick="() => ShowAddItemForm(null)">Add Item</button>

                    @if (showAddItem && addItemToCategoryId == null)
                    {
                        <div>
                            <input type="text" @bind="newItem.Name" placeholder="Item Name" />
                            <input type="text" @bind="newItem.Description" placeholder="Description" />
                            <input type="number" @bind="newItem.Price" placeholder="Price" />
                            <input type="text" @bind="newItem.CurrencyCode" placeholder="Currency (PLN)" />
                            <input type="text" @bind="newItem.ImagePath" placeholder="Image Path" />
                            <button @onclick="() => AddItem(null)">Add</button>
                            <button @onclick="() => showAddItem = false">Cancel</button>
                        </div>
                    }

                    @foreach (var item in uncategorizedItems)
                    {
                        <MenuItemEditComponent
                            Item="item"
                            Categories="categories"
                            OnSave="SaveItem"
                            OnDelete="DeleteItem"
                            OnMove="HandleMoveItem" />
                    }
                </div>
            }
        </div>
    </div>
}
else
{
    <div>Loading menu data...</div>
}
