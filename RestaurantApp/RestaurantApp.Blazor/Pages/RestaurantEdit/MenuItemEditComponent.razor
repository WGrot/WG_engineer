@using RestaurantApp.Shared.Models
@using RestaurantApp.Blazor.Models.DTO
@inject HttpClient Http

<div style="border: 1px solid #ddd; margin: 5px; padding: 5px;">
    @if (Editing)
    {
        <input type="text" @bind="Item.Name" placeholder="Name" />
        <input type="text" @bind="Item.Description" placeholder="Description" />
        <input type="number" @bind="Item.Price.Price" placeholder="Price" />
        <input type="text" @bind="Item.Price.CurrencyCode" placeholder="Currency" />
        <input type="text" @bind="Item.ImageUrl" placeholder="Image URL" />

        <button @onclick="OnSaveClicked">Save</button>
        <button @onclick="OnCancelClicked">Cancel</button>
    }
    else
    {
        @if (!string.IsNullOrEmpty(Item.ImageUrl))
        {
            <div>
                <img src="@Item.ImageUrl" alt="@Item.Name" width="100" style="border-radius:8px; margin:5px;" />
                <br />
                <button @onclick="() => DeleteItemImage(Item.Id)">Delete image</button>
            </div>
        }
        else
        {
            <p><em>No photo</em></p>
        }

        <InputFile OnChange="(e) => UploadItemImage(e, Item.Id)" />

        <strong>@Item.Name</strong>  @Item.Price.Price @Item.Price.CurrencyCode
        <br />
        @Item.Description
        <br />
        
        @foreach (var tag in Item.Tags)
        {
            <span style="background-color: @tag.ColorHex; padding: 5px;">@tag.Name</span>
        }

        <button @onclick="OnEditClicked">Edit</button>
        <button @onclick="() => OnDelete.InvokeAsync(Item.Id)">Delete</button>
        <button @onclick="OnMoveClicked">Move to Category</button>
        <button @onclick="() => ShowTagDropdown = true">Move to Category</button>
    }

    @if (ShowMoveDropdown)
    {
        <select @onchange="(e) => MoveItem(Item.Id, e.Value?.ToString())">
            <option value="">Select category...</option>
            <option value="uncategorized">No category</option>
            @foreach (var cat in Categories)
            {
                <option value="@cat.Id">@cat.Name</option>
            }
        </select>
        <button @onclick="() => ShowMoveDropdown = false">Cancel</button>
    }

    @if (ShowTagDropdown)
    {
        <select @onchange="(e) => AddTag(Item.Id, e.Value?.ToString())">
            <option value="">Select tag...</option>
            @foreach (var tag in Tags)
            {
                <option value="@tag.Id">@tag.Name</option>
            }
        </select>
        <button @onclick="() => ShowMoveDropdown = false">Cancel</button>
    }
    
    @if (ShowVariants)
    {
        @foreach (var variant in Variants)
        {
            <div>
                @if (editingVariantId == variant.Id)
                {
                    <div>
                        <input @bind="editVariant.Name" placeholder="Nazwa" />
                        <input type="number" @bind="editVariant.Price" placeholder="Cena" />
                        <input @bind="editVariant.Description" placeholder="Opis" />
                        <button @onclick="() => SaveVariantEdit(variant.Id)">Zapisz</button>
                        <button @onclick="CancelEdit">Anuluj</button>
                    </div>
                }
                else
                {
                    <div>
                        <strong>@variant.Name</strong> @variant.Price @Item.Price.CurrencyCode
                        <br />
                        @variant.Description
                        <br />
                        <button @onclick="() => StartEdit(variant)">Edytuj</button>
                        <button @onclick="() => DeleteVariant(variant.Id)">Usuń</button>
                    </div>
                }
                <hr />
            </div>
        }
    
        @if (isAddingNew)
        {
            <div>
                <h4>Nowy wariant</h4>
                <input @bind="newVariant.Name" placeholder="Nazwa" />
                <input type="number" @bind="newVariant.Price" placeholder="Cena" />
                <input @bind="newVariant.Description" placeholder="Opis" />
                <button @onclick="AddNewVariant">Dodaj</button>
                <button @onclick="CancelAddNew">Anuluj</button>
            </div>
        }
        else
        {
            <button @onclick="StartAddNew">+ Dodaj nowy wariant</button>
        }
    }
    else
    {
        <button @onclick="() => ShowVariants = true">Show variants</button>
    }
</div>
