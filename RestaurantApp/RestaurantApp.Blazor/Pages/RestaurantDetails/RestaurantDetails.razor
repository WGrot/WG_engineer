@page "/restaurant/{id:int}"
@using RestaurantApp.Blazor.Components
@using RestaurantApp.Shared.DTOs.Restaurant
@inject HttpClient Http

<div class="container-fluid p-0">
    @if (_restaurant == null)
    {
        <div class="loading-container">
            <div class="spinner"></div>
            <p>Loading restaurant details...</p>
        </div>
    }
    else
    {
        <!-- Header with restaurant branding -->
        <div class="restaurant-header bg-primary text-white">
            <div class="container py-4">
                <div class="row align-items-center">
                    <div class="col-auto">
                        @if (!string.IsNullOrEmpty(_restaurant.ProfileThumbnailUrl))
                        {
                            <img src="@_restaurant.ProfileThumbnailUrl"
                                 alt="@_restaurant.Name"
                                 class="restaurant-logo rounded shadow-sm">
                        }
                        else
                        {
                            <div
                                class="restaurant-logo-placeholder rounded shadow-sm d-flex align-items-center justify-content-center bg-white text-primary">
                                <i class="bi bi-shop fs-1"></i>
                            </div>
                        }
                    </div>
                    <div class="col-auto">
                        <StarRating
                            Restaurant="_restaurant"/>
                        <h1 class="h2 mb-1">@_restaurant.Name</h1>
                        <p class="mb-0 opacity-75">
                            <i class="bi bi-geo-alt-fill me-1"></i>
                            @_restaurant.Address
                        </p>
                    </div>
                    <div class="col-auto ms-1">
                        <button class="base-button lg" @onclick="@(() => _activeTab = "table-availability")">
                            Book Table
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="bg-light border-bottom sticky-top">
            <div class="container">
                <ul class="nav nav-tabs border-0 pt-2" role="tablist">
                    <li class="nav-item">
                        <button class="nav-link @(_activeTab == "info" ? "active" : "") px-4 py-3 border-0 rounded-top"
                                @onclick="@(() => _activeTab = "info")"
                                type="button">
                            <i class="bi bi-info-circle me-2"></i>
                            Info
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link @(_activeTab == "menu" ? "active" : "") px-4 py-3 border-0 rounded-top"
                                @onclick="@(() => _activeTab = "menu")"
                                type="button">
                            <i class="bi bi-book me-2"></i>
                            Menu
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link @(_activeTab == "tables" ? "active" : "") px-4 py-3 border-0 rounded-top"
                                @onclick="@(() => _activeTab = "tables")"
                                type="button">
                            <i class="bi bi-grid-3x3-gap me-2"></i>
                            Tables
                        </button>
                    </li>
                    <li class="nav-item">
                        <button
                            class="nav-link @(_activeTab == "table-availability" ? "active" : "") px-4 py-3 border-0 rounded-top"
                            @onclick="@(() => _activeTab = "table-availability")"
                            type="button">
                            <i class="bi bi-calendar-check me-2"></i>
                            Table Booking
                        </button>
                    </li>
                    <li class="nav-item">
                        <button
                            class="nav-link @(_activeTab == "reviews" ? "active" : "") px-4 py-3 border-0 rounded-top"
                            @onclick="@(() => _activeTab = "reviews")"
                            type="button">
                            <i class="bi bi-star-half me-2"></i>
                            Reviews
                        </button>
                    </li>

                </ul>
            </div>
        </div>

        <!-- Tab Content -->
        <div class="container my-4">
            <div class="tab-content">
                @switch (_activeTab)
                {
                    case "info":
                        <div class="tab-pane fade show active">
                            <RestaurantInfoTab Id=@Id Restaurant=@_restaurant/>
                        </div>
                        break;
                    case "menu":
                        <div class="tab-pane fade show active">
                            <RestaurantMenuTab Id=@Id Restaurant=@_restaurant/>
                        </div>
                        break;
                    case "tables":
                        <div class="tab-pane fade show active">
                            <RestaurantTablesTab Id=@Id Restaurant=@_restaurant/>
                        </div>
                        break;
                    case "reviews":
                        <div class="tab-pane fade show active">
                            <RestaurantReviewsTab Id=@Id Restaurant=@_restaurant/>
                        </div>
                        break;
                    case "table-availability":
                        <div class="tab-pane fade show active">
                            <TableBookingForm Id=@Id Restaurant=@_restaurant/>
                        </div>
                        break;
                }
            </div>
        </div>
    }
</div>


@code {
    [Parameter] public int Id { get; set; }

    string _activeTab = "info";

    private RestaurantDto? _restaurant;
    private bool _isLoading = false;

    protected override async Task OnInitializedAsync()
    {
        await LoadRestaurant();
    }

    private async Task LoadRestaurant()
    {
        try
        {
            _isLoading = true;
            _restaurant = await Http.GetFromJsonAsync<RestaurantDto>($"api/Restaurant/{Id}");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading restaurant: {ex.Message}");
            _restaurant = null;
        }
        finally
        {
            _isLoading = false;
        }
    }
    
}