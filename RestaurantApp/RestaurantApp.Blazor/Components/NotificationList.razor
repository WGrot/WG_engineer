@using RestaurantApp.Blazor.Services
@using RestaurantApp.Shared
@using RestaurantApp.Shared.Common
@using RestaurantApp.Shared.Models
@inject NotificationService NotificationService
@implements IDisposable

@{
    var containerClass = NotificationService.IsListVisible ? "visible" : "";
}

<div class="notification-list-container @containerClass">

    <div class="notification-header">
        <h4>Notifications</h4>
        @if (NotificationService.Notifications.Any())
        {
            <button class="clear-all-btn" @onclick="ClearAll">Clear all</button>
        }
    </div>
    
    <div class="notification-items">
        @if (NotificationService.Notifications.Any())
        {
            @foreach (var notification in NotificationService.Notifications.Reverse())
            {
                <div class="notification-item @GetCssClass(notification.Type)">
                    
                    <div class="notification-content">
                        <strong>@notification.Title</strong>
                        <p>@notification.Content</p>
                    </div>
                    <button class="dismiss-btn" @onclick="() => Remove(notification)">
                        <i class="bi bi-x"></i>
                    </button>
                    </div>
            }
        }
        else
        {
            <div class="no-notifications">
                <p>No new notifications.</p>
            </div>
        }
    </div>
</div>

@code {
    protected override void OnInitialized()
    {
        NotificationService.OnChange += StateHasChanged;
    }

    private string GetCssClass(NotificationTypeEnumDto type) => type switch
    {
        NotificationTypeEnumDto.Success => "notification-success",
        NotificationTypeEnumDto.Error => "notification-error",
        NotificationTypeEnumDto.Warning => "notification-warning",
        NotificationTypeEnumDto.Info => "notification-info",
        _ => "notification-info"
    };
    
    private void Remove(Notification notification)
    {
        NotificationService.RemoveNotification(notification);
    }

    private void ClearAll()
    {
        NotificationService.ClearAll();
    }

    public void Dispose()
    {
        NotificationService.OnChange -= StateHasChanged;
    }
}